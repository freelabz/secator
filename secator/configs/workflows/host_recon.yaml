type: workflow
name: host_recon
alias: hostrec
description: Host recon
long_description: |
  Performs comprehensive reconnaissance on a host or IP address to identify open ports and services.
  Combines multiple port scanning techniques, detects service versions, searches for known vulnerabilities,
  audits SSH configurations, and probes HTTP services. Optionally runs nuclei scans for network and
  SSL vulnerabilities. Essential for understanding a host's security posture and attack surface.
tags: [recon, network, http]
input_types:
  - ip
  - host
  - cidr_range

options:
  nuclei:
    is_flag: True
    default: False
    help: Run nuclei scans (slow)

  scanners:
    type: list
    required: True
    default: [nmap, naabu]
    help: Port scanners to use (naabu, nmap)

tasks:

  _group:
    naabu:
      description: Find open ports (light)
      if: "'naabu' in opts.scanners"

    nmap:
      description: Find open ports (light)
      if: "'nmap' in opts.scanners"

  nmap/vulners:
    description: Search for vulnerabilities on open ports
    version_detection: True
    script: vulners
    targets_:
    - port.host
    ports_:
    - type: port
      field: port
      condition: port.host in targets
    if: "'nmap' in opts.scanners"

  sshaudit:
    description: Audit SSH port
    targets_:
    - type: port
      field: host
      condition: "port.port == 22 or 'ssh' in port.service_name.lower()"

  _group/1:
    httpx:
      description: Probe HTTP services on open ports
      tech_detect: True
      targets_:
        - type: port
          field: '{host}:{port}'

    searchsploit:
      description: Search for related exploits
      targets_:
        - type: port
          field: '{host}:{port}~{service_name}'
          condition: len(item.service_name.split('/')) > 1

    search_vulns:
      description: Search for related exploits
      targets_:
        - type: port
          field: '{host}:{port}~{service_name}'
          condition: len(item.service_name.split('/')) > 1
        - type: vulnerability
          field: '{matched_at}~{id}'

  _group/2:
    nuclei/network:
      description: Scan network and SSL vulnerabilities
      tags: [network, ssl]
      if: opts.nuclei

    nuclei/url:
      description: Search for vulnerabilities on alive HTTP services
      exclude_tags: [network, ssl, file, dns, osint, token-spray, headers]
      targets_:
        - type: url
          field: url
          condition: item.status_code != 0
      if: opts.nuclei
