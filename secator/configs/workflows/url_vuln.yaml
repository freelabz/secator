type: workflow
name: url_vuln
alias: url_vuln
description: URL vulnerability scan (gf, dalfox)
long_description: |
  Scans URLs for common web vulnerabilities using pattern matching and automated testing tools.
  Identifies potential XSS, LFI, SSRF, RCE, IDOR, and other vulnerability indicators in URL parameters.
  Tests discovered vulnerable patterns with specialized tools like Dalfox for XSS exploitation.
  Optionally runs comprehensive nuclei scans for additional HTTP vulnerability detection.
tags: [http, vulnerability]
input_types:
  - url

options:
  passive:
    is_flag: True
    help: Passive only (no requests to targets)
    default: False
    short: ps

  nuclei:
    is_flag: True
    default: False
    help: Run nuclei on tagged URLs (slow)

tasks:
  _group/pattern_analysis:
    gf/xss:
      description: Hunt XSS params
      pattern: xss

    gf/lfi:
      description: Hunt LFI params
      pattern: lfi

    gf/ssrf:
      description: Hunt SSRF params
      pattern: ssrf

    gf/rce:
      description: Hunt RCE params
      pattern: rce

    gf/interestingparams:
      description: Hunt interest params
      pattern: interestingparams

    gf/idor:
      description: Hunt Idor params
      pattern: idor

    gf/debug_logic:
      description: Hunt debug params
      pattern: debug_logic

  _group/vuln_scan:
    dalfox:
      description: Attack XSS vulnerabilities
      targets_:
        - type: tag
          field: match
          condition: item._source.startswith("gf")
      if: not opts.passive

    nuclei:
      description: Search for HTTP vulns
      exclude_tags: [network, ssl, file, dns, osint, token-spray, headers]
      targets_:
        - type: target
          field: name
        - type: tag
          field: match
          condition: item._source.startswith("gf")
      if: opts.nuclei and not opts.passive
  # TODO: Add support for SQLMap
  # sqlmap:
  #   description: Attack SQLI vulnerabilities
  #   targets_:
  #     - type: tag
  #       field: match
  #       condition: item.name in ['sqli']

  # TODO: Make this work, need transform functions to replace a parameter fetched dynamically by the keyword 'FUZZ'
  # ffuf:
  #   description: Attack LFI vulnerabilities
  #   targets_:
  #     - type: tag
  #       field: match
  #       transform:
  #         qsreplace: FUZZ
  #       condition: item.name in ['lfi']
